<!DOCTYPE html>
<html>
    
<head>
<link rel="stylesheet" href="main.css">
</head>

<body>
    <div id='wrapper'>
        <div id='header'>HUOM! Tieto ei sisällä kaikkia paikkoja, ja voi olla virheellistä!<div>
        <div id="googleMap"></div>
        <div id='footer'>Oikea tieto https://korona.soite.fi/altistumispaikat/<div>
   </div>

<script>
var prev_infowindow =false; 

function myMap() 
{
    var mapProp= {
  center:new google.maps.LatLng(63.8455696,23.1328219),
  zoom:9,
};

var map = new google.maps.Map(document.getElementById("googleMap"),mapProp);

fetch(`https://coronscrapper.azurewebsites.net/api/GetExposures`,
        {method: 'GET',headers: {
        'Accept': 'application/json'
        }}
        )
    .then((response) => 
    {
        return response.json()
    })
    .then((data) => 
    {
        // Work with JSON data here
        //console.log(data)
        const obj = JSON.parse(data)
        l = Object.keys(obj.Result).length

        for (var item in obj.Result) 
        {
            //console.log(obj.Result[item])
            dataItem = obj.Result[item]
            const latLng = new google.maps.LatLng(dataItem.Latitude, dataItem.Longitude);

            var marker = new google.maps.Marker({
            position: latLng,
            map: map,
            icon: "icon49.png"
            });

            attachSecretMessage(marker, dataItem.FullText);
        }
    })
    .catch((err) => {
        // Do something for an error here
    })

}

function attachSecretMessage(marker, secretMessage) 
{
  const infowindow = new google.maps.InfoWindow({
    content: secretMessage,
  });

  marker.addListener("click", () => 
  {
    if( prev_infowindow ) {
           prev_infowindow.close();
        }

        prev_infowindow = infowindow;

    infowindow.open(marker.get("map"), marker);
  });
}

$(document).ready(function () {
  timeout(Alert(""),5000)
});

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCf0kv8oNZLcbKZJ30xNL_0LTPt4krcRg8&callback=myMap"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script>
$(document).ready(function () {
    setTimeout(alert("HUOM! Data voi olla puutteellista, tarkista tiedot Soiten sivuilta"),5000)
  });
  
  </script>

</body>
</html>